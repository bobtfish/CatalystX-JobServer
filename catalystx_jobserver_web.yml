---
name: "CatalystX::JobServer::Web"
Model::MessageQueue:
    class: "CatalystX::JobServer::MessageQueue"
    args:
        port: 5672
        host: localhost
        vhost: /
        channels:
            jobs:
                exchanges:
                    - type: topic
                      durable: 1
                      exchange: jobs
                queues:
                    - queue: jobs_queue
                      durable: 1
                      bind:
                        exchange: jobs
                        routing_key: "#"
                dispatch_to: ForkedJobRunner
                results_exchange: firehose
                results_routing_key: ""
            firehose:
                exchanges:
                    - type: topic
                      durable: 1
                      exchange: firehose
                queues:
# FIXME - Needs to go away if not listening, be anon - fixme!
                    - queue: firehose_log
                      durable: 1
                      bind:
                          exchange: firehose
                          routing_key: "#"
                dispatch_to: FireHoseLog
                results_exchange: firehose
                results_routing_key: ""
Model::ForkedJobRunner:
    class: "CatalystX::JobServer::JobRunner::Forked"
    traits:
        - PostForkCallback
        - JobFinishedCallback
        - PublishSelf
    args:
        publish_self_every: 10
        publish_self_to: jobs
        jobs_registered:
            - "CatalystX::JobServer::Job::Test::RunForThirtySeconds"
        job_finished_callback: "warn('JOB FINISHED')"
        debug_messages_consumed: "1"
Model::FireHoseLog:
    class: "CatalystX::JobServer::LogWriter"
    args:
        output_file: __path_to(firehose.log)__
